<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create TRC</title>
    <script>
        // Function to get URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                productTitle: params.get('productTitle'),
                caseNumber: params.get('caseNumber'),
                sheetID: params.get('sheetID'),
                folderId: params.get('folderId')
            };
        }

        // Retrieve parameters from the URL
        const { productTitle, caseNumber, sheetID, folderId } = getUrlParams();

        async function getAccessToken() {
            try {
                const response = await fetch('https://oauth2.googleapis.com/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({
                        client_id: '472088230940-057aqhlph3g6e6826bk9090m9qefdp7o.apps.googleusercontent.com',
                        client_secret: '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',
                        refresh_token: '1//04nwSCuTf_AQGCgYIARAAGAQSNwF-L9Irqvb59w_L7K-SAZLi3CLtKs1vxtFm42YJomuXlbGVJzoxx328J1-N7AQLhYIeY8orHb4',
                        grant_type: 'refresh_token'
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to refresh access token');
                }

                const data = await response.json();
                return data.access_token;
            } catch (error) {
                console.error('Error fetching access token:', error);
            }
        }

        async function createTRC() {
            const accessToken = await getAccessToken();
            if (!accessToken) {
                alert('Failed to get access token');
                return;
            }

            // Use the access token to interact with Google Drive or Sheets API
            // Example: Create a new TRC document in the specified folder
            try {
                const response = await fetch(`https://www.googleapis.com/drive/v3/files?access_token=${accessToken}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: `${productTitle} TRC`,
                        mimeType: 'application/vnd.google-apps.document',
                        parents: [folderId]
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to create TRC document');
                }

                const fileData = await response.json();
                console.log('TRC document created:', fileData);
                alert('TRC document created successfully');
            } catch (error) {
                console.error('Error creating TRC document:', error);
                alert('Failed to create TRC document');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('create-trc-button').addEventListener('click', createTRC);
        });
    </script>
</head>
<body>
    <h1>Create TRC for ${productTitle}</h1>
    <p>Case Number: ${caseNumber}</p>
    <p>Sheet ID: ${sheetID}</p>
    <button id="create-trc-button">Create TRC</button>
</body>
</html>